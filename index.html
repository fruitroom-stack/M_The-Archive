<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ARCHIVE | curate for home</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #FDFCFB; --accent: #121212; }
        body { 
            background-color: var(--bg); color: var(--accent); font-family: 'Noto Serif KR', serif; overflow-x: hidden;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
        }
        .font-brand { font-family: 'Playfair Display', serif; }
        .font-ui { font-family: 'Inter', sans-serif; }
        .archive-card { transition: all 0.4s ease; border: 1px solid rgba(0,0,0,0.05); background: #fff; border-radius: 2rem; overflow: hidden; position: relative; }
        .selected { border-color: #000; transform: scale(0.97); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .check-badge { position: absolute; top: 1.2rem; left: 1.2rem; width: 22px; height: 22px; background: #000; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; z-index: 10; border: 2px solid #fff; }
        .sticky-nav { position: sticky; top: 0; z-index: 1000; background: rgba(253, 252, 251, 0.95); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .main-upload-btn { background-color: #000; color: #fff; width: 100%; max-width: 400px; padding: 2rem 1.5rem; border-radius: 2rem; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.3s ease; cursor: pointer; margin: 0 auto 3rem; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; }

        @media print {
            @page { size: A4; margin: 0; }
            #root > div > .no-print, #root > div > main, #root > div > footer, .settings-modal { display: none !important; }
            .print-container { display: block !important; width: 210mm; }
            .print-page { page-break-after: always; height: 297mm; overflow: hidden; display: flex !important; flex-direction: column; align-items: center; background: white; box-sizing: border-box; }
            .print-cover { justify-content: center; }
            .cover-title { font-size: 60px; margin-bottom: 20px; }
            .cover-credit { font-size: 12px; font-weight: bold; letter-spacing: 0.2em; opacity: 0.6; }
            .content-page { justify-content: flex-start; padding: 15mm 20mm; }
            .print-header { width: 100%; display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid #121212; padding-bottom: 5mm; margin-bottom: 15mm; }
            .print-image-box { width: 100%; height: 55%; display: flex; align-items: center; justify-content: center; margin-bottom: 15mm; }
            .print-image-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
            .print-text-box { width: 100%; text-align: center; }
        }
        .print-container { display: none; }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">
    <div id="root"></div>
    <script type="text/babel">
        window.addEventListener('keydown', function(e) {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) || (e.ctrlKey && e.keyCode === 85)) {
                e.preventDefault(); return false;
            }
        });

        const { useState, useMemo, useEffect } = React;

        const App = () => {
            // [데이터 로드] 브라우저에 저장된 설정이 있으면 가져오고, 없으면 기본값 사용
            const getSavedData = (key, defaultValue) => {
                const saved = localStorage.getItem(key);
                return saved ? JSON.parse(saved) : defaultValue;
            };

            const [view, setView] = useState('home');
            const [items, setItems] = useState([]);
            const [selectedIds, setSelectedIds] = useState([]);
            const [currentCategory, setCurrentCategory] = useState(null);
            const [isSelectMode, setIsSelectMode] = useState(false);
            
            // 영구 저장될 상태들
            const [brandTitle, setBrandTitle] = useState(() => getSavedData('brandTitle', 'THE ARCHIVE'));
            const [curatorName, setCuratorName] = useState(() => getSavedData('curatorName', 'Heewon Yoo'));
            const [categories, setCategories] = useState(() => getSavedData('categories', [
                { id: 'cat1', name: 'Ideas & Notes', color: '#FFD93D' }, 
                { id: 'cat2', name: 'Home & Interior', color: '#95E1D3' },
                { id: 'cat3', name: 'Health & Fitness', color: '#6BCB77' }, 
                { id: 'cat4', name: 'Fashion & Shopping', color: '#FCBAD3' },
                { id: 'cat5', name: 'Study & Learning', color: '#F38181' }, 
                { id: 'cat6', name: 'Misc', color: '#9E9E9E' }
            ]));
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);

            // [데이터 저장] 설정이 바뀔 때마다 브라우저에 자동 저장
            useEffect(() => { localStorage.setItem('brandTitle', JSON.stringify(brandTitle)); }, [brandTitle]);
            useEffect(() => { localStorage.setItem('curatorName', JSON.stringify(curatorName)); }, [curatorName]);
            useEffect(() => { localStorage.setItem('categories', JSON.stringify(categories)); }, [categories]);

            const addCategory = () => {
                const newCat = { id: crypto.randomUUID(), name: 'New Category', color: '#E2E2E2' };
                setCategories([...categories, newCat]);
            };

            const removeCategory = (id) => {
                if (categories.length <= 1) return alert("At least one category is required.");
                if (confirm("Delete this category? Items will be moved to the first category.")) {
                    const firstCatId = categories.find(c => c.id !== id).id;
                    setItems(items.map(item => item.category === id ? {...item, category: firstCatId} : item));
                    setCategories(categories.filter(c => c.id !== id));
                }
            };

            const extractThumb = (file) => {
                return new Promise((resolve) => {
                    const video = document.createElement('video');
                    video.preload = 'metadata'; video.muted = true; video.playsInline = true;
                    video.src = URL.createObjectURL(file);
                    video.onloadeddata = () => { video.currentTime = 0.5; };
                    video.onseeked = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg'));
                    };
                    video.onerror = () => resolve(null);
                });
            };

            const onFileUpload = async (e) => {
                const files = Array.from(e.target.files);
                const filteredFiles = files.filter(file => file.type.startsWith('image/') || file.type.startsWith('video/'));
                if (filteredFiles.length < files.length) alert("Only image and video files can be imported.");
                const newItems = await Promise.all(filteredFiles.map(async (file) => {
                    let previewUrl = URL.createObjectURL(file);
                    const isVideo = file.type.startsWith('video/');
                    if (isVideo) { const thumb = await extractThumb(file); if (thumb) previewUrl = thumb; }
                    return { id: crypto.randomUUID(), preview: previewUrl, note: '', category: currentCategory || categories[0].id, type: isVideo ? 'video' : 'image', date: new Date().toLocaleDateString() };
                }));
                setItems(prev => [...newItems, ...prev]);
                if(newItems.length > 0 && view === 'home') setView('list');
            };

            const addWebArchive = () => {
                let url = prompt("아카이브할 URL:");
                if (!url) return;
                if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
                const newItem = { id: crypto.randomUUID(), preview: `https://api.microlink.io?url=${encodeURIComponent(url)}&screenshot=true&embed=screenshot.url`, note: `Link: ${url}`, category: currentCategory || categories[0].id, type: 'website', url: url, date: new Date().toLocaleDateString() };
                setItems(prev => [newItem, ...prev]);
                if(view === 'home') setView('list');
            };

            const downloadZip = async () => {
                const zip = new JSZip();
                const targets = items.filter(i => selectedIds.includes(i.id));
                for (let i = 0; i < targets.length; i++) {
                    const res = await fetch(targets[i].preview);
                    const blob = await res.blob();
                    zip.file(`archive_${i+1}.jpg`, blob);
                }
                zip.generateAsync({type:"blob"}).then(c => saveAs(c, "Selection.zip"));
            };

            const toggleSelectAll = () => {
                const currentItems = currentCategory ? items.filter(i => i.category === currentCategory) : items;
                setSelectedIds(selectedIds.length === currentItems.length ? [] : currentItems.map(i => i.id));
            };

            const moveSelectedToCategory = (catId) => {
                setItems(prev => prev.map(item => selectedIds.includes(item.id) ? { ...item, category: catId } : item));
                setSelectedIds([]);
                setIsSelectMode(false);
            };

            const filteredItems = useMemo(() => currentCategory ? items.filter(i => i.category === currentCategory) : items, [items, currentCategory]);
            const printItems = useMemo(() => selectedIds.length > 0 ? items.filter(i => selectedIds.includes(i.id)) : filteredItems, [items, selectedIds, filteredItems]);

            return (
                <div className="flex flex-col min-h-screen">
                    {isSettingsOpen && (
                        <div className="fixed inset-0 z-[2000] flex items-center justify-center bg-black/20 backdrop-blur-sm no-print">
                            <div className="bg-white p-10 rounded-[2.5rem] shadow-2xl w-full max-w-lg border border-gray-100 max-h-[90vh] overflow-y-auto">
                                <h2 className="font-brand italic text-3xl mb-8">Settings</h2>
                                <div className="space-y-8 text-left">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="font-ui text-[10px] uppercase font-bold opacity-40 block mb-2">Title</label><input value={brandTitle} onChange={(e) => setBrandTitle(e.target.value)} className="w-full border-b border-gray-200 py-2 focus:outline-none focus:border-black font-brand text-xl bg-transparent" /></div>
                                        <div><label className="font-ui text-[10px] uppercase font-bold opacity-40 block mb-2">Curator</label><input value={curatorName} onChange={(e) => setCuratorName(e.target.value)} className="w-full border-b border-gray-200 py-2 focus:outline-none focus:border-black font-ui text-sm bg-transparent" /></div>
                                    </div>
                                    <div className="pt-4">
                                        <div className="flex justify-between items-center mb-4">
                                            <label className="font-ui text-[10px] uppercase font-bold opacity-40">Manage Categories</label>
                                            <button onClick={addCategory} className="text-[10px] font-bold text-blue-500 uppercase hover:underline">+ Add New</button>
                                        </div>
                                        <div className="space-y-4">
                                            {categories.map((cat) => (
                                                <div key={cat.id} className="flex items-center gap-4 group">
                                                    <input type="color" value={cat.color} onChange={(e) => setCategories(categories.map(c => c.id === cat.id ? {...c, color: e.target.value} : c))} className="w-8 h-8 rounded-full cursor-pointer transition-transform hover:scale-110" />
                                                    <input value={cat.name} onChange={(e) => setCategories(categories.map(c => c.id === cat.id ? {...c, name: e.target.value} : c))} className="flex-1 border-b border-transparent group-hover:border-gray-100 focus:border-black py-1 text-sm outline-none bg-transparent transition-all font-ui font-medium" />
                                                    <button onClick={() => removeCategory(cat.id)} className="opacity-0 group-hover:opacity-40 hover:!opacity-100 text-red-500 transition-all"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <button onClick={() => setIsSettingsOpen(false)} className="w-full mt-10 bg-black text-white py-4 rounded-full font-ui text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-all shadow-lg">Save & Close</button>
                            </div>
                        </div>
                    )}

                    <div className="no-print sticky-nav">
                        <div className="max-w-7xl mx-auto px-8 py-6 flex justify-between items-center">
                            <div onClick={() => {setView('home'); setCurrentCategory(null); setIsSelectMode(false); setSelectedIds([]);}} className="cursor-pointer text-left">
                                <h1 className="text-4xl font-brand italic tracking-tighter">{brandTitle}</h1>
                                <p className="text-[10px] tracking-[0.2em] uppercase font-ui font-bold mt-1 tracking-widest">made by curate for home | {curatorName}</p>
                            </div>
                            <div className="flex items-center gap-4 font-ui text-[11px] font-bold uppercase tracking-widest text-left">
                                {view === 'list' && <button onClick={addWebArchive} className="hover:underline opacity-60 mr-2">Reference Website</button>}
                                <button onClick={() => setIsSettingsOpen(true)} className="px-5 py-2 rounded-full border border-gray-200 hover:bg-gray-100 transition-all opacity-60">Settings</button>
                                <div className="flex items-center gap-2">
                                    <button onClick={() => { setIsSelectMode(!isSelectMode); setSelectedIds([]); }} className={`px-5 py-2 rounded-full transition-all border ${isSelectMode ? 'bg-black text-white border-black shadow-md' : 'bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200'}`}>{isSelectMode ? 'Cancel' : 'Select'}</button>
                                    {isSelectMode && <button onClick={toggleSelectAll} className="px-4 py-2 bg-white border border-gray-200 rounded-full hover:bg-gray-50 transition-colors">{selectedIds.length === filteredItems.length ? 'Deselect All' : 'Select All'}</button>}
                                </div>
                                {selectedIds.length > 0 && (
                                    <div className="flex items-center gap-4 border-l pl-4 border-gray-200">
                                        <button onClick={downloadZip} className="hover:underline text-blue-600 font-bold">ZIP</button>
                                        <div className="flex gap-2 items-center">{categories.map(cat => (<button key={cat.id} onClick={() => moveSelectedToCategory(cat.id)} className="w-4 h-4 rounded-full shadow-sm hover:scale-125 transition-transform" style={{backgroundColor: cat.color}} />))}</div>
                                        <button onClick={() => { if(confirm('Delete?')) setItems(items.filter(i => !selectedIds.includes(i.id))); setSelectedIds([]); }} className="text-red-400">Delete</button>
                                    </div>
                                )}
                                <button onClick={() => window.print()} className="bg-black text-white px-6 py-2 rounded-full hover:bg-gray-800 transition-all ml-2 shadow-lg">Print PDF</button>
                            </div>
                        </div>
                    </div>

                    <main className="max-w-7xl mx-auto px-8 pt-12 pb-20 flex-grow">
                        {view === 'home' ? (
                            <div className="flex flex-col">
                                <label className="main-upload-btn no-print"><span className="font-brand italic text-2xl mb-1">Import Media</span><span className="font-ui text-[9px] uppercase tracking-widest font-bold opacity-60">Images & Videos Only</span><input type="file" multiple accept="image/*,video/*" onChange={onFileUpload} className="hidden" /></label>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                    {categories.map(cat => (
                                        <div key={cat.id} onClick={() => {setCurrentCategory(cat.id); setView('list');}} className="archive-card p-10 cursor-pointer hover:shadow-xl group border-gray-50 text-left">
                                            <div className="w-10 h-10 rounded-full mb-6" style={{backgroundColor: cat.color}}></div>
                                            <h3 className="text-2xl font-brand italic group-hover:underline">{cat.name}</h3>
                                            <p className="text-[10px] uppercase opacity-40 mt-2 font-ui font-bold tracking-widest">{items.filter(i => i.category === cat.id).length} Records</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-left">
                                {filteredItems.map(item => (
                                    <div key={item.id} onClick={() => isSelectMode && setSelectedIds(prev => prev.includes(item.id) ? prev.filter(id => id !== item.id) : [...prev, item.id])} className={`archive-card flex flex-col h-full ${isSelectMode ? 'cursor-pointer shadow-lg' : ''} ${selectedIds.includes(item.id) ? 'selected' : ''}`}>
                                        {selectedIds.includes(item.id) && <div className="check-badge font-ui">✓</div>}
                                        <div className="aspect-[4/5] bg-gray-50 m-2 rounded-[1.5rem] overflow-hidden"><img src={item.preview} className="w-full h-full object-contain p-4" crossOrigin="anonymous" onContextMenu={(e) => e.preventDefault()} /></div>
                                        <div className="p-6 pt-2 flex-1 flex flex-col">
                                            <textarea value={item.note} onClick={e => e.stopPropagation()} onChange={e => setItems(items.map(i => i.id === item.id ? {...i, note: e.target.value} : i))} className="w-full bg-transparent resize-none focus:outline-none text-[15px] font-serif h-32 leading-relaxed text-gray-700" placeholder="Write a note..." />
                                            <div className="mt-auto pt-4 flex justify-between items-center text-[9px] uppercase font-ui font-bold opacity-30 tracking-widest">
                                                <span>{categories.find(c => c.id === item.category)?.name}</span>
                                                {!isSelectMode && <button onClick={(e) => {e.stopPropagation(); setItems(items.filter(i => i.id !== item.id));}} className="hover:text-red-500">Remove</button>}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    <footer className="no-print max-w-7xl mx-auto w-full px-8 py-12 border-t border-gray-100 mt-20 text-left">
                        <div className="flex flex-col md:flex-row justify-between items-start gap-8 opacity-40">
                            <div>
                                <h4 className="font-brand italic text-xl mb-2">Curate for Home LLC | Heewon Yoo</h4>
                                <div className="flex items-center gap-3">
                                    <p className="font-ui text-[10px] uppercase font-bold tracking-[0.2em]">© 2024-2026 All Rights Reserved.</p>
                                    <a href="https://www.instagram.com/curateforhome" target="_blank" rel="noopener noreferrer" className="hover:opacity-100 flex items-center gap-1 transition-all">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
                                        <span className="font-ui text-[10px] uppercase font-bold tracking-[0.2em]">Instagram</span>
                                    </a>
                                </div>
                            </div>
                            <div className="space-y-1">
                                <a href="https://curateforhome.com" target="_blank" rel="noopener noreferrer" className="block font-ui text-[11px] font-bold hover:underline transition-all">curateforhome.com</a>
                                <div className="flex gap-4"><a href="mailto:info@curateforhome.com" className="font-ui text-[11px] font-bold hover:underline transition-all">info@curateforhome.com</a><a href="mailto:heewon.yoo@exprealty.com" className="font-ui text-[11px] font-bold hover:underline transition-all">heewon.yoo@exprealty.com</a></div>
                                <p className="font-ui text-[9px] uppercase tracking-widest mt-4 tracking-[0.1em]">Licensed Realtor in NJ & NY | Affiliate of eXp Realty</p>
                            </div>
                        </div>
                    </footer>

                    <div className="print-container">
                        <div className="print-page print-cover">
                            <h1 className="cover-title font-brand italic tracking-tighter">{currentCategory ? categories.find(c => c.id === currentCategory).name : brandTitle}</h1>
                            <p className="cover-credit font-ui tracking-widest uppercase">made by curate for home | {curatorName}</p>
                        </div>
                        {printItems.map(item => (
                            <div key={`p-${item.id}`} className="print-page content-page">
                                <div className="print-header"><div className="font-brand italic text-3xl tracking-tighter">{brandTitle}</div><div className="font-ui text-[11px] uppercase font-bold tracking-[0.3em] opacity-40">{categories.find(c => c.id === item.category)?.name}</div></div>
                                <div className="print-image-box"><img src={item.preview} crossOrigin="anonymous" /></div>
                                <div className="print-text-box">
                                    <p className="text-2xl leading-relaxed font-serif italic text-gray-800 mb-10 whitespace-pre-wrap">{item.note || "No memo."}</p>
                                    <div className="w-20 h-px bg-gray-200 mx-auto mb-6 opacity-40"></div>
                                    <p className="text-[11px] uppercase font-ui opacity-100 tracking-[0.2em] font-bold">Curate for Home LLC | {curatorName}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>