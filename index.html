<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE ARCHIVE | Professional System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #FDFCFB; --accent: #121212; }
        body { 
            background-color: var(--bg); color: var(--accent); font-family: 'Noto Serif KR', serif; overflow-x: hidden;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
        }
        .font-brand { font-family: 'Playfair Display', serif; }
        .font-ui { font-family: 'Inter', sans-serif; }
        .archive-card { transition: all 0.4s ease; border: 1px solid rgba(0,0,0,0.05); background: #fff; border-radius: 1.5rem; overflow: hidden; position: relative; }
        .selected { border-color: #000; transform: scale(0.97); }
        .check-badge { position: absolute; top: 1rem; left: 1rem; width: 20px; height: 20px; background: #000; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; z-index: 10; border: 2px solid #fff; }
        .sticky-nav { position: sticky; top: 0; z-index: 1000; background: rgba(253, 252, 251, 0.9); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        
        /* 모바일 대응 업로드 버튼 */
        .main-upload-btn { background-color: #000; color: #fff; width: 100%; max-width: 400px; padding: 1.5rem; border-radius: 1.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; margin: 0 auto 2rem; }

        @media print {
            @page { size: A4; margin: 0; }
            html, body { height: auto !important; overflow: visible !important; }
            #root > div > .no-print, #root > div > main, #root > div > footer, .settings-modal { display: none !important; }
            .print-container { display: block !important; width: 210mm; background: white; }
            .print-page { 
                page-break-after: always !important; 
                break-after: page !important;
                height: 296.5mm; /* 빈 페이지 방지를 위해 약간 줄임 */
                overflow: hidden; 
                display: flex !important; 
                flex-direction: column; 
                align-items: center; 
                background: white; 
                position: relative;
            }
            .print-cover { justify-content: center; }
            .content-page { justify-content: flex-start; padding: 20mm; }
            .print-header { width: 100%; display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid #121212; padding-bottom: 5mm; margin-bottom: 15mm; }
            .print-image-box { width: 100%; height: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 15mm; }
            .print-image-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
            .print-text-box { width: 100%; text-align: center; }
        }
        .print-container { display: none; }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">
    <div id="root"></div>
    <script type="text/babel">
        // 보안 로직
        window.addEventListener('keydown', function(e) {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) || (e.ctrlKey && e.keyCode === 85)) {
                e.preventDefault(); return false;
            }
        });

        const { useState, useMemo, useEffect } = React;

        const App = () => {
            const getSavedData = (key, defaultValue) => {
                const saved = localStorage.getItem(key);
                try { return saved ? JSON.parse(saved) : defaultValue; } catch(e) { return defaultValue; }
            };

            const [view, setView] = useState('home');
            const [items, setItems] = useState([]);
            const [selectedIds, setSelectedIds] = useState([]);
            const [currentCategory, setCurrentCategory] = useState(null);
            const [isSelectMode, setIsSelectMode] = useState(false);
            
            const [brandTitle, setBrandTitle] = useState(() => getSavedData('brandTitle', 'THE ARCHIVE'));
            const [curatorName, setCuratorName] = useState(() => getSavedData('curatorName', 'Heewon Yoo'));
            const [officialEmail, setOfficialEmail] = useState(() => getSavedData('officialEmail', 'info@curateforhome.com'));
            const [officialWeb, setOfficialWeb] = useState(() => getSavedData('officialWeb', 'curateforhome.com'));
            const [officialInsta, setOfficialInsta] = useState(() => getSavedData('officialInsta', 'curateforhome'));
            
            const [categories, setCategories] = useState(() => getSavedData('categories', [
                { id: 'cat1', name: 'Ideas & Notes', color: '#FFD93D' }, 
                { id: 'cat2', name: 'Home & Interior', color: '#95E1D3' },
                { id: 'cat3', name: 'Health & Fitness', color: '#6BCB77' }, 
                { id: 'cat4', name: 'Fashion & Shopping', color: '#FCBAD3' },
                { id: 'cat5', name: 'Study & Learning', color: '#F38181' }, 
                { id: 'cat6', name: 'Misc', color: '#9E9E9E' }
            ]));
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);

            useEffect(() => { 
                localStorage.setItem('brandTitle', JSON.stringify(brandTitle));
                localStorage.setItem('curatorName', JSON.stringify(curatorName));
                localStorage.setItem('officialEmail', JSON.stringify(officialEmail));
                localStorage.setItem('officialWeb', JSON.stringify(officialWeb));
                localStorage.setItem('officialInsta', JSON.stringify(officialInsta));
                localStorage.setItem('categories', JSON.stringify(categories)); 
            }, [brandTitle, curatorName, officialEmail, officialWeb, officialInsta, categories]);

            const addCategory = () => {
                const newCat = { id: crypto.randomUUID(), name: 'New Category', color: '#E2E2E2' };
                setCategories([...categories, newCat]);
            };

            const extractThumb = (file) => {
                return new Promise((resolve) => {
                    const video = document.createElement('video');
                    video.preload = 'metadata'; video.muted = true; video.playsInline = true;
                    video.src = URL.createObjectURL(file);
                    video.onloadeddata = () => { video.currentTime = 0.5; };
                    video.onseeked = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg'));
                    };
                    video.onerror = () => resolve(null);
                });
            };

            const onFileUpload = async (e) => {
                const files = Array.from(e.target.files);
                const filteredFiles = files.filter(file => file.type.startsWith('image/') || file.type.startsWith('video/'));
                const newItems = await Promise.all(filteredFiles.map(async (file) => {
                    let previewUrl = URL.createObjectURL(file);
                    const isVideo = file.type.startsWith('video/');
                    if (isVideo) { const thumb = await extractThumb(file); if (thumb) previewUrl = thumb; }
                    return { id: crypto.randomUUID(), preview: previewUrl, note: '', category: currentCategory || categories[0].id, type: isVideo ? 'video' : 'image', date: new Date().toLocaleDateString() };
                }));
                setItems(prev => [...newItems, ...prev]);
                if(newItems.length > 0 && view === 'home') setView('list');
            };

            const addWebArchive = () => {
                let url = prompt("URL to archive:");
                if (!url) return;
                if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
                const newItem = { id: crypto.randomUUID(), preview: `https://api.microlink.io?url=${encodeURIComponent(url)}&screenshot=true&embed=screenshot.url`, note: `Link: ${url}`, category: currentCategory || categories[0].id, type: 'website', url: url, date: new Date().toLocaleDateString() };
                setItems(prev => [newItem, ...prev]);
                if(view === 'home') setView('list');
            };

            const filteredItems = useMemo(() => currentCategory ? items.filter(i => i.category === currentCategory) : items, [items, currentCategory]);
            const printItems = useMemo(() => selectedIds.length > 0 ? items.filter(i => selectedIds.includes(i.id)) : filteredItems, [items, selectedIds, filteredItems]);

            return (
                <div className="flex flex-col min-h-screen">
                    {isSettingsOpen && (
                        <div className="fixed inset-0 z-[2000] flex items-center justify-center bg-black/20 backdrop-blur-sm no-print p-4">
                            <div className="bg-white p-6 md:p-10 rounded-[2rem] shadow-2xl w-full max-w-2xl border border-gray-100 max-h-[90vh] overflow-y-auto">
                                <h2 className="font-brand italic text-2xl md:text-3xl mb-8">Brand Settings</h2>
                                <div className="space-y-6 md:space-y-10 text-left">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8">
                                        <div><label className="font-ui text-[9px] uppercase font-bold opacity-40 block mb-1">Title</label><input value={brandTitle} onChange={(e) => setBrandTitle(e.target.value)} className="w-full border-b border-gray-200 py-2 focus:outline-none focus:border-black font-brand text-lg bg-transparent" /></div>
                                        <div><label className="font-ui text-[9px] uppercase font-bold opacity-40 block mb-1">Curator</label><input value={curatorName} onChange={(e) => setCuratorName(e.target.value)} className="w-full border-b border-gray-200 py-2 focus:outline-none focus:border-black font-ui text-sm bg-transparent" /></div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-50">
                                        <div><label className="font-ui text-[9px] uppercase font-bold opacity-40 block mb-1">Email</label><input value={officialEmail} onChange={(e) => setOfficialEmail(e.target.value)} className="w-full border-b border-gray-100 py-1 text-[11px] outline-none focus:border-black bg-transparent" /></div>
                                        <div><label className="font-ui text-[9px] uppercase font-bold opacity-40 block mb-1">Website</label><input value={officialWeb} onChange={(e) => setOfficialWeb(e.target.value)} className="w-full border-b border-gray-100 py-1 text-[11px] outline-none focus:border-black bg-transparent" /></div>
                                        <div><label className="font-ui text-[9px] uppercase font-bold opacity-40 block mb-1">Instagram ID</label><input value={officialInsta} onChange={(e) => setOfficialInsta(e.target.value)} className="w-full border-b border-gray-100 py-1 text-[11px] outline-none focus:border-black bg-transparent" /></div>
                                    </div>
                                    <div className="pt-6 border-t border-gray-50">
                                        <div className="flex justify-between items-center mb-6">
                                            <label className="font-ui text-[10px] uppercase font-bold opacity-40">Categories</label>
                                            <button onClick={addCategory} className="text-[10px] font-bold text-blue-500 uppercase">+ Add</button>
                                        </div>
                                        <div className="space-y-3">
                                            {categories.map((cat) => (
                                                <div key={cat.id} className="flex items-center gap-3">
                                                    <input type="color" value={cat.color} onChange={(e) => setCategories(categories.map(c => c.id === cat.id ? {...c, color: e.target.value} : c))} className="w-6 h-6 rounded-full cursor-pointer" />
                                                    <input value={cat.name} onChange={(e) => setCategories(categories.map(c => c.id === cat.id ? {...c, name: e.target.value} : c))} className="flex-1 border-b border-transparent hover:border-gray-100 focus:border-black py-1 text-sm outline-none bg-transparent" />
                                                    <button onClick={() => { if(categories.length > 1) setCategories(categories.filter(c => c.id !== cat.id)); }} className="text-red-300 hover:text-red-500"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <button onClick={() => setIsSettingsOpen(false)} className="w-full mt-10 bg-black text-white py-4 rounded-full font-ui text-xs font-bold uppercase tracking-widest">Apply Branding</button>
                            </div>
                        </div>
                    )}

                    <div className="no-print sticky-nav">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center text-left">
                            <div onClick={() => {setView('home'); setCurrentCategory(null); setIsSelectMode(false); setSelectedIds([]);}} className="cursor-pointer">
                                <h1 className="text-2xl md:text-4xl font-brand italic tracking-tighter truncate max-w-[150px] md:max-w-none">{brandTitle}</h1>
                                <p className="text-[8px] md:text-[10px] tracking-[0.2em] uppercase font-ui font-bold mt-0.5 tracking-widest truncate">by {curatorName}</p>
                            </div>
                            <div className="flex items-center gap-3 md:gap-4 font-ui text-[9px] md:text-[11px] font-bold uppercase tracking-widest">
                                {view === 'list' && <button onClick={addWebArchive} className="hidden md:block hover:underline opacity-60">Web Reference</button>}
                                <button onClick={() => setIsSettingsOpen(true)} className="px-3 md:px-5 py-2 rounded-full border border-gray-200 hover:bg-gray-100 opacity-60 transition-all">Settings</button>
                                <button onClick={() => window.print()} className="bg-black text-white px-4 md:px-6 py-2 rounded-full hover:bg-gray-800 transition-all shadow-lg">Print PDF</button>
                            </div>
                        </div>
                    </div>

                    <main className="max-w-7xl mx-auto px-6 pt-8 pb-20 flex-grow w-full">
                        {view === 'home' ? (
                            <div className="flex flex-col">
                                <label className="main-upload-btn no-print">
                                    <span className="font-brand italic text-xl mb-1">Import Media</span>
                                    <span className="font-ui text-[8px] uppercase tracking-widest font-bold opacity-60">Photos & Videos</span>
                                    <input type="file" multiple accept="image/*,video/*" onChange={onFileUpload} className="hidden" />
                                </label>
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-8 text-left">
                                    {categories.map(cat => (
                                        <div key={cat.id} onClick={() => {setCurrentCategory(cat.id); setView('list');}} className="archive-card p-6 md:p-10 cursor-pointer hover:shadow-xl group border-gray-50">
                                            <div className="w-6 h-6 md:w-8 md:h-8 rounded-full mb-4 md:mb-6" style={{backgroundColor: cat.color}}></div>
                                            <h3 className="text-lg md:text-2xl font-brand italic group-hover:underline truncate">{cat.name}</h3>
                                            <p className="text-[8px] md:text-[10px] uppercase opacity-40 mt-2 font-ui font-bold tracking-widest">{items.filter(i => i.category === cat.id).length} Records</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 text-left">
                                {filteredItems.map(item => (
                                    <div key={item.id} onClick={() => isSelectMode && setSelectedIds(prev => prev.includes(item.id) ? prev.filter(id => id !== item.id) : [...prev, item.id])} className={`archive-card flex flex-col h-full ${selectedIds.includes(item.id) ? 'selected' : ''}`}>
                                        {selectedIds.includes(item.id) && <div className="check-badge font-ui">✓</div>}
                                        <div className="aspect-[4/5] bg-gray-50 m-2 rounded-[1rem] overflow-hidden"><img src={item.preview} className="w-full h-full object-contain p-4" crossOrigin="anonymous" onContextMenu={(e) => e.preventDefault()} /></div>
                                        <div className="p-4 md:p-6 pt-2 flex-1 flex flex-col">
                                            <textarea value={item.note} onClick={e => e.stopPropagation()} onChange={e => setItems(items.map(i => i.id === item.id ? {...i, note: e.target.value} : i))} className="w-full bg-transparent resize-none focus:outline-none text-[13px] md:text-[15px] font-serif h-24 md:h-32 leading-relaxed text-gray-700" placeholder="Write a note..." />
                                            <div className="mt-auto pt-4 flex justify-between items-center text-[8px] uppercase font-ui font-bold opacity-30 tracking-widest">
                                                <span>{categories.find(c => c.id === item.category)?.name}</span>
                                                <button onClick={(e) => {e.stopPropagation(); setItems(items.filter(i => i.id !== item.id));}} className="hover:text-red-500">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    <footer className="no-print max-w-7xl mx-auto w-full px-6 py-12 border-t border-gray-100 mt-12 text-left opacity-40">
                        <div className="flex flex-col md:flex-row justify-between items-start gap-8">
                            <div>
                                <h4 className="font-brand italic text-lg md:text-xl mb-1">{brandTitle} | {curatorName}</h4>
                                <p className="font-ui text-[8px] md:text-[10px] uppercase font-bold tracking-[0.2em]">© 2024-2026 All Rights Reserved.</p>
                            </div>
                            <div className="space-y-1 text-[10px] md:text-[11px] font-bold font-ui">
                                <p>{officialWeb}</p>
                                <p>{officialEmail}</p>
                                <p className="mt-4 text-[8px] opacity-60 tracking-widest uppercase">Professional Digital Archive</p>
                            </div>
                        </div>
                    </footer>

                    <div className="print-container">
                        <div className="print-page print-cover">
                            <h1 className="cover-title font-brand italic tracking-tighter">{currentCategory ? categories.find(c => c.id === currentCategory).name : brandTitle}</h1>
                            <p className="cover-credit font-ui tracking-widest uppercase">made by {brandTitle} | {curatorName}</p>
                        </div>
                        {printItems.map(item => (
                            <div key={`p-${item.id}`} className="print-page content-page text-center">
                                <div className="print-header"><div className="font-brand italic text-3xl tracking-tighter">{brandTitle}</div><div className="font-ui text-[11px] uppercase font-bold tracking-[0.3em] opacity-40">{categories.find(c => c.id === item.category)?.name}</div></div>
                                <div className="print-image-box"><img src={item.preview} crossOrigin="anonymous" /></div>
                                <div className="print-text-box">
                                    <p className="text-2xl leading-relaxed font-serif italic text-gray-800 mb-10 whitespace-pre-wrap">{item.note || "No memo."}</p>
                                    <div className="w-20 h-px bg-gray-200 mx-auto mb-6 opacity-40"></div>
                                    <p className="text-[11px] uppercase font-ui opacity-100 tracking-[0.2em] font-bold">{brandTitle} | {curatorName}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
